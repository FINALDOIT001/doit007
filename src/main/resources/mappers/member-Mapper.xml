<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberMapper">
    
   	<resultMap id="memberResultSet" type="Member">
   		<id property="mno" column="M_NO"/>
   		<result property="mId" column="M_ID"/>
   		<result property="mPwd" column="M_PWD" />
   		<result property="mName" column="M_NAME" />
   		<result property="mAddr" column="M_ADDR" />
   		<result property="mPhone" column="M_PHONE" />
   		<result property="mEmail" column="M_EMAIL" />
   		<result property="mOriginalfilename" column="M_ORIGINAL_FILENAME" />
   		<result property="mRenamefilename" column="M_RENAME_FILENAME" />
   		<result property="mEnrolldate" column="M_ENROLL_DATE" />
   		<result property="mUpdatedate" column="M_UPDATE_DATE" />
   		<result property="mhodu" column="M_HODU" />
   		<result property="mUserroles" column="M_USERROLES" />
   		<result property="mStatus" column="M_STATUS" />
    </resultMap>
    
    <resultMap id="hoduResultSet" type="Hodu">
    	<id property="hNo" column="H_NO"/>
    	<result property="hmId" column="H_MID"/>
    	<result property="hoduNum" column="HODU"/>
    	<result property="hPrice" column="H_PRICE"/>
    	<result property="hDate" column="H_DATE"/>
    	
    	<association property="member" javaType="Member">
    		<result property="mId" column="M_ID"/>
    	</association>
    </resultMap>
    

    
    
    <select id="idCheck" parameterType="string" resultType="_int">
    	SELECT COUNT(*)
    	FROM MEMBER
    	WHERE M_ID=#{mId}
    </select> 
    

    <insert id="insertMember" parameterType="Member">
    	INSERT INTO MEMBER 
    	VALUES (SEQ_MNO.NEXTVAL,#{mId}, #{mPwd}, #{mName}, #{mAddr}, #{mPhone}, 
    			#{mEmail}, default, default, SYSDATE, SYSDATE, default, default, default)
    </insert>
    
    <select id="memberLogin" parameterType="Member" resultMap="memberResultSet">
    	SELECT *
    	FROM MEMBER
    	WHERE M_ID=#{mId}
    	AND M_STATUS = 'Y'
    </select>
    
    <update id="memberupdate" parameterType="Member">
    	UPDATE MEMBER
    	SET M_PWD=#{mPwd},M_NAME=#{mName},M_ADDR=#{mAddr},M_PHONE=#{mPhone},M_EMAIL=#{mEmail},
    		M_ORIGINAL_FILENAME=#{mOriginalfilename},M_RENAME_FILENAME=#{mRenamefilename},
    		M_UPDATE_DATE=SYSDATE
    	WHERE M_ID=#{mId}
    </update>
    
    <select id="selectMember" resultMap="memberResultSet">
    	SELECT *
    	FROM MEMBER
    	WHERE M_ID=#{mId}
    </select>
    
    <update id="deleteMember" parameterType="string">
    	UPDATE MEMBER
    	SET M_STATUS='N'
    	WHERE M_ID=#{mId}
    </update>
    
    <insert id="inserthodu" parameterType="Hodu">
    	INSERT INTO HODU_TABLE
    	VALUES (SEQ_HNO.NEXTVAL,#{hmNo}, #{hmId}, #{hoduNum}, #{hPrice}, SYSDATE)
    </insert>
    
    <select id="selecthList" resultMap="hoduResultSet">
    	SELECT H.H_NO, H.HODU, H.H_PRICE, H.H_DATE
    	FROM HODU_TABLE H JOIN MEMBER M
    	ON H_MID = M.M_ID
    	WHERE H.H_MID = #{mId}
    	ORDER BY 1 DESC
    </select>
    
    <!-- <update id="updatemhodu" parameterType="_int" >
    	UPDATE MEMBER
		SET M_HODU = (SELECT SUM(H.HODU)
		FROM HODU_TABLE H JOIN MEMBER M
		ON M.M_NO = H.H_MNO
		WHERE M.M_NO = #{hmNo})
		WHERE M_NO = #{hmNo};
    </update> -->
    
    <update id="updateHoduTest">
    	UPDATE 	MEMBER
   		SET		M_HODU = M_HODU + #{hoduNum}
   		WHERE	1=1
   		AND		M_NO=#{hmNo}
    </update>
    
    <select id="selectHodunum" resultMap="memberResultSet">
    	SELECT *
    	FROM MEMBER
    	WHERE M_NO=#{mno}
    </select>
    
    <select id="countId" resultType="_int">
    	SELECT COUNT(*)
    	FROM MEMBER
    	WHERE M_EMAIL=#{email}
    </select>
    
    <select id="searchId" resultType="string">
    	SELECT M_ID
    	FROM MEMBER
    	WHERE M_EMAIL=#{email}
    </select>
</mapper>